<div id="tutorialStateRules">
  <div class="oppia-rules-container" ng-repeat="(handlerName, handler) in interactionHandlers">
    <div class="oppia-rule-tabs-container">
      <ul class="nav nav-stacked nav-pills" role="tablist" ui-sortable="RULE_LIST_SORTABLE_OPTIONS" ng-model="handler" style="margin-right: -15px;">
        <!-- An HTML element marked ui-sortable should contain only one element,
        and this element should have an ng-repeat defined on it. See the
        ui-sortable documentation for more details. -->
        <!-- Note that adding "track by $index" here seems to mess up the final
        index in the stop() event handler. -->
        <li ng-repeat="rule in handler" ng-class="{'active': activeRuleIndex == $index}" class="oppia-sortable-rule-block" ng-hide="$last" style="margin-top: 0;">
          <span class="oppia-rule-sort-arrows-container oppia-rule-sort-handle" ng-if="!$last && handler.length > 2">
            <span class="glyphicon glyphicon-sort oppia-rule-sort-arrows"></span>
          </span>
          <a ng-click="changeActiveRuleIndex($index)" href="#" class="oppia-rule-tab oppia-rule-sort-handle protractor-test-rule-tab" ng-class="{'active': activeRuleIndex == $index}" style="border-radius: 0;">Rule #<[$index + 1]></a>
        </li>

        <li ng-class="{'active': activeRuleIndex === handler.length - 1}" style="margin-top: 0;">
          <a ng-click="changeActiveRuleIndex(handler.length - 1)" href="#" class="oppia-rule-tab protractor-test-default-rule-tab" ng-class="{'active': activeRuleIndex == $index}" style="border-radius: 0;">Default</a>
        </li>
      </ul>

      <div ng-if="getCurrentInteractionId() !== 'Continue' && editabilityService.isEditable()">
        <button type="button" class="btn btn-default btn-lg oppia-add-rule-button protractor-test-open-add-rule-modal" ng-click="openAddRuleModal()">
          Add Rule
        </button>
      </div>
    </div>

    <div class="oppia-rule-bodies-container">
      <div ng-repeat="rule in handler track by $index" class="tab-pane" ng-show="activeRuleIndex == $index" style="height: 100%;">
        <rule-editor rule="rule" num-rules="handler.length" answer-choices="answerChoices" interaction-handler-specs="interactionHandlerSpecs" save-rule="saveRule" delete-rule="deleteRule(handlerName, $index)" is-editable="editabilityService.isEditable()" ng-class="{'protractor-test-rule-body': !$last, 'protractor-test-default-rule-body': $last}">
        </rule-editor>
      </div>
    </div>
  </div>
</div>

<a class="oppia-state-navigation-bar" ng-if="nextStateName !== editorContextService.getActiveStateName() && nextStateName !== 'END'" ng-click="navigateToState(nextStateName)">
  <span class="glyphicon glyphicon-chevron-down" style="margin-top: 7px;">
  </span>
</a>

<script type="text/ng-template" id="modals/addRule">
  <div class="modal-header">
    <h3>Add Rule</h3>
  </div>

  <div class="modal-body">
    <rule-description-editor current-rule-description="currentRuleDescription" current-rule-definition="currentRuleDefinition" interaction-handler-specs="interactionHandlerSpecs" answer-choices="answerChoices" class="protractor-test-temporary-rule"></rule-description-editor>
  </div>

  <div class="modal-footer">
    <button class="btn btn-default" ng-click="cancel()">Cancel</button>
    <button class="btn btn-success protractor-test-add-new-rule" ng-click="addNewRule()">Add New Rule</button>
  </div>
</script>
